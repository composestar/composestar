<?xml version="1.0" encoding="UTF-8"?>
<project name="ComposeStar/StarLight/Compiletime" default="build">

	<condition property="build.core" value="../../../Core">
		<and>
			<not><isset property="build.core"/></not>
			<available file="../../../Core/common.xml"/>
		</and>
	</condition>
	
	<import file="${build.core}/common.xml"/>
		
	<echo>Processing: ${ant.project.name} ...</echo>	
	<description>The Compose* StarLight Compiletime</description>

	<target name="clean" depends="init" description="clean the compilation results">
		
		<!-- Java build files -->
		<delete dir="${out.build}"/>
		<delete dir="${out.dist}"/>
		<delete>
			<fileset dir="Composestar">
				<include name="**/*.class"/>
			</fileset>
		</delete>
		
	</target>
	
	<target name="init_local" depends="init">
		<mkdir dir="${out.build}"/>
		<mkdir dir="${out.dist}"/>
	</target>
	
	<target name="build" depends="init_local,build_xmltypes,compile_java,jar,compile_starlight" description="compile the StarLight compiletime"/>
	
	<target name="antlr">
		<!--
		<antlr target="${CSharpDummyGenerator}/Parse/csharp.g" outputdirectory="${CSharpDummyGenerator}/Parse">
			<classpath refid="lib.dotnet"/>
		</antlr>
		-->
	</target>
	
	<target name="create_xsd">
    <msbuild solution="..\StarLightEntities\StarLightEntities.csproj" target="build"/>
    <exec dir="..\StarLightEntities\bin\debug" executable="xsd.exe">
  		<arg line="Composestar.StarLight.Entities.dll" />
  		<arg line="/outputdir:../../obj" />
		</exec>
  </target>
	
	<target name="build_xmltypes" depends="create_xsd">
	  <xmlbean schema="../StarLightEntities/obj/schema0.xsd" destfile="../../Libraries/xmltypes.jar" classpath="../../Libraries/xmlbeans/xbean.jar:../../Libraries/xmlbeans/jsr173_1.0_api.jar" />
	</target>
	
	<target name="compile_java">
		<javac srcdir="Composestar" destdir="${out.build}" classpathref="lib.starlight" source="${build.java.version}" target="${build.java.version}" debug="${build.debug}" deprecation="${build.debug}">
			<exclude name="**/AssemblyInfo.java"/>
		</javac>
	</target>
			
	<target name="compile_starlight">
		
	</target>

	<target name="jar">
		<jar destfile="${out.jar.starlight}" basedir="${out.build}" manifest="composestar/MANIFEST.MF"/>
	</target>
	
	<taskdef name="xmlbean"
     classname="org.apache.xmlbeans.impl.tool.XMLBean"
     classpath="../../Libraries/xmlbeans/xbean.jar:../../Libraries/xmlbeans/jsr173_1.0_api.jar" />

		
</project>