<?xml version='1.0' encoding='utf-8'?> 
<secret>
	
	<filters>
		<filter type="Error">
			<accept action="continue"/>
			<reject action="error"/>
		</filter>
		<filter type="Dispatch">
			<accept action="dispatch"/>
			<reject action="continue"/>
		</filter>
		<filter type="Meta">
			<accept action="meta"/>
			<reject action="continue"/>
		</filter>
    		<filter type="Substitute">
      			<accept action="substitute"/>
      			<reject action="continue"/>
    		</filter>
    		<filter type="Wait">
      			<accept action="continue"/>
      			<reject action="wait"/>
     		</filter>
	</filters>
	
	<actions>
    		<action name="continue"/>
		
		<action name="meta">
		</action>
		
		<action name="error" endofset="true">
      			<operation name="discard" resource="args"/>
      			<operation name="error" resource="message"/>
      			<operation name="return" resource="message"/>
		</action>
		
		<action name="dispatch" endofset="true">
	  		<operation name="dispatch" resource="message"/>
	  		<operation name="write" resource="target"/>
	  		<operation name="write" resource="selector"/>
	  		<operation name="read" resource="args"/>
	  		<operation name="return" resource="message"/> 
		</action>
	  
		<action name="substitute">
			<operation name="write" resource="target"/>
			<operation name="write" resource="selector"/>
		</action>
	
		<action name="wait">
	  		<operation name="write" resource="timing"/>
		</action>
	
	</actions>
	
	<constraints>
	  	<conflict pattern="[(return)(reply)]+(.*)(error)" resource="message" message="Message is returned before it could error.."/>
		<conflict pattern="(discard)[(read)(write)]+" resource="args" message="Discarded resources should not be read or written."/>
		<conflict pattern="(read)(decrypt)" resource="args" message="Arguments should be decrypted before logging!" />
		<conflict pattern="(encrypt)(read)" resource="args" message="Arguments should be encrypted after logging!" />
	</constraints>

	<resources>
		<resource name="message" alphabet="resume,proceed,reply,respond"/>
		<resource name="args" alphabet="read,write,decrypt,encrypt"/>
		<resource name="target" alphabet="read,write"/>
		<resource name="selector" alphabet="read,write"/>
		<resource name="sender" alphabet="read,write"/>
	</resources>
</secret>
