<project name="Composestar/Java/Testing" default="test" xmlns:cs="antlib:Composestar">

	<description>
	Run the Compose* SystemTest for Java
	</description>

	<condition property="build.core" value="${basedir}/../../Core">
		<and>
			<not><isset property="build.core"/></not>
			<available file="${basedir}/../../Core/common.xml"/>
		</and>
	</condition>
	
	<import file="${build.core}/common.xml"/>

	<target name="clean" depends="init">
		<!-- delete /obj dirs -->
		<delete includeEmptyDirs="true">
			<FileSet dir="${build.java}/Examples">
				<include name="**/obj/"/>
			</FileSet>
		</delete>
		<!-- delete generated files in /bin -->
		<!-- (cannot delete the whole dir because of correct.txt files and such) -->
		<delete includeEmptyDirs="true">
			<FileSet dir="${build.java}/Examples">
				<include name="**/bin/**/*.class"/>
				<include name="**/bin/**/repository.dat"/>
			</FileSet>
		</delete>
		<!-- delete /analyses dir -->
		<delete includeEmptyDirs="true">
			<FileSet dir="${build.java}/Examples">
				<include name="**/analyses/"/>
			</FileSet>
		</delete>
	</target>
	
	<target name="build"/>

	<target name="test" depends="test_comp,test_exec" description="Execute the Java system test."/>
	
	<!-- compile projects -->
	<target name="test_comp" depends="init_eclipse">
		<cs:j_comp workspace="${build.java}/Examples" eclipseHome="${eclipse.home}" application="Composestar.Eclipse.Plugin.Java.testbuild">
			<DirSet dir="${build.java}/Examples">
				<include name="BasicTests"/>
				<include name="ConditionTests"/>
				<include name="ErrorFilterTest"/>
				<include name="Pacman"/>
				<include name="Platypus"/>
				<include name="VenusFlyTrap"/> 
				<exclude name="**/.svn/"/>
				<exclude name="**/.metadata/"/>
			</DirSet>
		</cs:j_comp>
	</target>

	
	<!-- execute tests -->
	<target name="test_exec" depends="test_comp,init_eclipse">
		<cs:j_test workspace="${build.java}/Examples" eclipseHome="${eclipse.home}" application="Composestar.Eclipse.Plugin.Java.testrun">
			<DirSet dir="${build.java}/Examples">
				<include name="BasicTests"/>
				<include name="ConditionTests"/>
				<include name="ErrorFilterTest"/>
				<include name="Platypus"/>
				<include name="VenusFlyTrap"/>
				<exclude name="**/.svn/"/>
				<exclude name="**/.metadata/"/>
			</DirSet>
		</cs:j_test>
	</target>

</project>
