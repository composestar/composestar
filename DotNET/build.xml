<?xml version="1.0" encoding="UTF-8"?>
<project name="ComposeStar/DotNET" default="build">

	<condition property="build.core" value="${basedir}${file.separator}..${file.separator}Core">
		<and>
			<not>
				<isset property="build.core" />
			</not>
			<available file="${basedir}${file.separator}..${file.separator}Core${file.separator}common.xml" />
		</and>
	</condition>
	<import file="${build.core}${file.separator}common.xml" />

	<echo>Processing: ${ant.project.name} ...</echo>
	
	<description>
	The Compose* .NET
	The .NET implementation of Compose*
	</description>

	<target name="clean" depends="init">
		<delete file="${build.dotnet}${file.separator}findbugs-result.html" />
		<ant target="clean" dir="Compiletime" />
		<ant target="clean" dir="Runtime" />
	</target>
	
	
	<target name="build" depends="init">
		<ant target="build" dir="Compiletime" />
		<ant target="build" dir="Runtime" />
	</target>
	
	<target name="plugin" depends="init">
		<ant target="build" dir="Plugin" />
	</target>
	
	<target name="findbugs" depends="init">
		<findbugs home="${bin.findbugs}" output="html" effort="max" reportLevel="medium" outputFile="${build.dotnet}${file.separator}findbugs-result.html" excludeFilter="${bin.findbugs}${file.separator}exclude.xml">
			<class location="${build.dotnet}${file.separator}Compiletime${file.separator}${out.jar.dotnet}" />
			<sourcePath path="${build.dotnet}${file.separator}Compiletime${file.separator}src" />
			<auxClasspath refid="lib.core" />
			<auxClasspath>
				<pathelement path="${build.core}${file.separator}Compiletime${file.separator}${out.jar.core}" />
			</auxClasspath>
		</findbugs>
	</target>
	
	<target name="test" depends="init,systemtest" />
	
	<target name="systemtest" depends="init">
		<condition property="systemtest.config" value="config.ini">
			<not>
				<isset property="systemtest.config" />
			</not>
		</condition>
		<exec executable="${build.dotnet}${file.separator}testing${file.separator}SystemTest${file.separator}SystemTest.exe" dir="${build.dotnet}${file.separator}testing${file.separator}SystemTest${file.separator}" output="${build.dotnet}${file.separator}SystemTest.log">
			<arg value="${systemtest.config}" />
		</exec>
	</target>
	
	<target name="install" depends="build">
		<ant target="install" dir="Compiletime" />
		<ant target="install" dir="Runtime" />
		<ant target="install" dir="Plugin" />
	</target>

</project>