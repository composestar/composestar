<?xml version="1.0" encoding="UTF-8"?>
<project name="ComposeStar" default="build">

	<import file="..${file.separator}common.xml" />	
	
	<!-- clean tasks -->
	
	<target name="clean" depends="init">
		<ant target="clean" dir="${build.core}" />
		<antcall target="clean_dotnet" />
		<antcall target="clean_java" />
		<antcall target="clean_c" />
	</target>
	
	<target name="clean_dotnet" if="available.dotnet">
		<ant target="clean" dir="${build.dotnet}" />
	</target>
	
	<target name="clean_java" if="available.java">
		<ant target="clean" dir="${build.java}" />
	</target>
	
	<target name="clean_c" if="available.c">
		<ant target="clean" dir="${build.c}" />
	</target>
	
	<!-- build tasks -->
	
	<target name="core" depends="init">
		<ant target="build" dir="${build.core}" />
	</target>
	
	<target name="dotnet" depends="core" if="available.dotnet">
		<ant target="build" dir="${build.dotnet}" />
	</target>
	
	<target name="java" depends="core" if="available.java">
		<ant target="build" dir="${build.java}" />
	</target>
	
	<target name="c" depends="core" if="available.c">
		<ant target="build" dir="${build.c}" />
	</target>
	
	<target name="build" depends="init,core,dotnet,java,c" />
	
	<!-- install tasks -->
	
	<target name="install" depends="init">
		<ant target="install" dir="${build.core}" />
		<antcall target="install_dotnet" />
	</target>
	
	<target name="install_dotnet" if="available.dotnet">
		<ant target="install" dir="${build.dotnet}" />
	</target>
	
	<!-- plugin tasks -->
	
	<target name="plugin" depends="init">
		<antcall target="plugin_dotnet" />
	</target>
	
	<target name="plugin_dotnet" depends="init" if="available.dotnet">
		<ant target="plugin" dir="${build.dotnet}" />
	</target>
	
	<!-- QA tasks -->
	
	<!-- execute the findbugs tool -->
	<target name="findbugs" depends="init">
		<antcall target="findbugs_core" />
		<antcall target="findbugs_dotnet" />
	</target>
	
	<target name="findbugs_core" depends="init">
		<ant target="findbugs" dir="${build.core}" />
	</target>
	
	<target name="findbugs_dotnet" depends="init" if="available.dotnet">
		<ant target="findbugs" dir="${build.dotnet}" />
	</target>
	
	<!-- system test -->
	
	<target name="test" depends="init">
		<antcall target="test_dotnet" />
	</target>
	
	<target name="test_dotnet" depends="init" if="available.dotnet">
		<ant target="test" dir="${build.dotnet}" />
	</target>
	
	<!-- do everything -->
	<target name="all" depends="clean,build,install,findbugs,test" />
	
	<!-- task selector -->
	
	<!--
	<target name="select" depends="init">
        <input message="Enter the desired action: "
               validargs="clean,build,rebuild,install,core,dotnet,java,c,findbugs,test"
               addproperty="build.target"
               defaultvalue="core"
        />
        <antcall target="${build.target}" />
    </target>
    -->

	<!-- fancy selection -->
	
	<target name="select">	
		<taskdef resource="com/sardak/antform/taskdefs.properties" classpath="${basedir}/Ant/lib/antform.jar" />
		<antmenu image="${basedir}/logo.gif" title="Compose* Build">
		
			<antMenuItem name="Advanced" >
				<antMenuItem name="Build">
					<antMenuItem name="Core" target="core" />
					<antMenuItem name="DotNET" target="dotnet" />
					<antMenuItem name="Java" target="java" />
					<antMenuItem name="C" target="c" />
				</antMenuItem>
				<antMenuItem name="Plugin">
					<antMenuItem name="DotNET" target="plugin_dotnet" />
				</antMenuItem>
			</antMenuItem>
		
			<link label="Clean the whole project" target="clean" />
			<link label="Build the whole project" target="build" />
			<link label="Clean &amp; Build" target="rebuild" />
			<link label="Install" target="install" />
			<link label="Run Findbugs" target="findbugs" />
			<!--<link label="Run the system test" target="test" />-->
			
			<separator />
			
			<!--<link label="Advanced" target="selector_advanced" />-->
		
			<link label="Cancel" target="cancel" />
		</antmenu>
	</target>

</project>