<!--

!! IMPORTANT !!

This configuration file is just for Compose*.
It is included from the CruiseControl configuration file in the CruiseControl directory.

-->
<cruisecontrol>
	<!-- location where cruise control is running, used for reporting -->
	<!--
	<property name="cchost" value="ewi650.cs.utwente.nl" />
	-->
	<!-- expose environment vars -->
	<property environment="env" toupper="true" />

	<project name="composestar.r2" buildafterfailed="false">
		<!-- set this to the location of the composestar root -->
		<property name="composestar.path" value="${${project.name}.path}" />
		<property name="composestar.ant" value="${composestar.path}\Core\Development\Ant" />
		<plugin name="labelincrementer" classname="net.sourceforge.cruisecontrol.labelincrementers.SVNLabelIncrementer"/>
		<labelincrementer labelprefix="build" separator="." workingcopypath="${composestar.path}" />

		<listeners>
			<!-- used by the reporting interface -->
			<currentbuildstatuslistener file="logs/${project.name}/status.txt" />
		</listeners>
		<bootstrappers>
			<!-- update Ant and CruiseControl before doing anything else -->
			<svnbootstrapper localWorkingCopy="${composestar.path}\Core\Development\Ant" />
			<svnbootstrapper localWorkingCopy="${composestar.path}\Core\Development\CruiseControl" />
		</bootstrappers>
		<!-- wait 5 minutes after the last commit before continuing -->
		<modificationset quietperiod="300">
			<!-- note: svn action needs svn commandline client in the path  -->
			<svn LocalWorkingCopy="${composestar.path}" property="composestar.modified" />
		</modificationset>
		<!-- waits 5 (default) minutes before trying another build (only if files have changed) -->
		<schedule>
			<ant target="integration" buildfile="${composestar.path}\Core\Development\build_total.xml"
				uselogger="true" anthome="${composestar.ant}" antWorkingDir="${composestar.path}"
				usedebug="false" />
		</schedule>
		<log>
			<merge file="${composestar.path}\Core\Compiletime\test\TESTS-TestSuites.xml" />
			<merge dir="${composestar.path}\Java\Testing" pattern="TEST-*.xml" />
			<merge file="${composestar.path}\Core\qa\checkstyle-result.xml" />
			<merge file="${composestar.path}\StarLight\qa\checkstyle-result.xml" />
			<merge file="${composestar.path}\Java\qa\checkstyle-result.xml" />
			<merge file="${composestar.path}\CwC\qa\checkstyle-result.xml" />
			<merge file="${composestar.path}\Core\qa\findbugs-result.xml" />
			<merge file="${composestar.path}\StarLight\qa\findbugs-result.xml" />
			<merge file="${composestar.path}\Java\qa\findbugs-result.xml" />
			<merge file="${composestar.path}\CwC\qa\findbugs-result.xml" />
			<gzip every="1" unit="WEEK" />
		</log>
		<publishers>
			<htmlemail buildresultsurl="http://${cchost}:8080/buildresults/${project.name}" xslfile="${composestar.path}\Core\Development\CruiseControl\buildresults.xslt"
				mailhost="smtp.utwente.nl" reportsuccess="fixes" skipusers="true" returnname="Continuous Integration Server"
				returnaddress="elmuerte@users.sourceforge.net">
				<always address="composestar-developers@lists.sourceforge.net" />
				<parameter name="buildresultsurl" value="http://${cchost}:8080/buildresults/${project.name}" />
				<parameter name="standalonehtml" value="1" />
				<parameter name="revisionurl" value="http://composestar.svn.sourceforge.net/viewvc/composestar?view=rev&amp;revision=" />
			</htmlemail>
			<onsuccess>
				<antpublisher target="integration_publish" buildfile="${composestar.path}\Core\Development\build_total.xml"
					uselogger="false" anthome="${composestar.ant}" antWorkingDir="${composestar.path}" usedebug="false" />
				<!-- Installers -->
				<!--
				<artifactspublisher dir="${composestar.path}/Starlight/Setup/Releases" dest="artifacts/${project.name}/" />
				<artifactspublisher dir="${composestar.path}/Java/Installer/eclipse/dist" dest="artifacts/${project.name}/" />
				-->
				<!-- QA -->
				<artifactspublisher dir="${composestar.path}/Core/qa" dest="artifacts/${project.name}/" subdirectory="qa_core" />
				<!--
				<artifactspublisher dir="${composestar.path}/Java/qa" dest="artifacts/${project.name}/" subdirectory="qa_java" />
				<artifactspublisher dir="${composestar.path}/Starlight/qa" dest="artifacts/${project.name}/" subdirectory="qa_starlight" />
				<artifactspublisher dir="${composestar.path}/CwC/qa" dest="artifacts/${project.name}/" subdirectory="qa_cwc" />
				-->
				<!-- clean up old artifacts, e.a. -->
				<antpublisher target="onsuccess" buildfile="${composestar.path}\Core\Development\CruiseControl\antextra.xml"
					uselogger="false" anthome="${composestar.ant}" antWorkingDir="${composestar.path}" usedebug="false" />
			</onsuccess>
		</publishers>
	</project>
</cruisecontrol>
